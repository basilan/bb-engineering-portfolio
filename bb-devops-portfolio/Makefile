.PHONY: help setup check steel-thread clean destroy

# Default target
help: ## Show this help message
	@echo "BB DevOps Portfolio - DevOps Reference Implementation"
	@echo "===================================================="
	@echo ""
	@echo "Essential targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  %-15s %s\n", $$1, $$2}'
	@echo ""
	@echo "üîÑ Steel-Thread Demo Flow:"
	@echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
	@echo "‚îÇ                          COMPLETE DEMO LIFECYCLE                           ‚îÇ"
	@echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
	@echo "‚îÇ  1Ô∏è‚É£  make setup     ‚Üí Initialize tools + create terraform.tfvars + SSH key ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ Tool detection (terraform, ansible, aws, python)                  ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ AWS credentials validation                                         ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ SSH key generation (if missing)                                   ‚îÇ"
	@echo "‚îÇ     ‚îî‚îÄ‚îÄ Terraform initialization                                           ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  2Ô∏è‚É£  make check     ‚Üí Quick validation without AWS deployment              ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ CLI tools detection                                                ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ Terraform syntax validation                                        ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ Ansible playbook syntax check                                      ‚îÇ"
	@echo "‚îÇ     ‚îî‚îÄ‚îÄ Test suite execution (infrastructure + configuration)             ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  3Ô∏è‚É£  make steel-thread ‚Üí Complete end-to-end demo (THE BIG KAHUNA)       ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ üîç Environment validation                                          ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ üöÄ Infrastructure provisioning (Terraform ‚Üí AWS)                  ‚îÇ"
	@echo "‚îÇ     ‚îÇ   ‚îî‚îÄ‚îÄ Creates: VPC, EC2, S3, CloudWatch, Security Groups           ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ ‚öôÔ∏è  Configuration management (Ansible)                            ‚îÇ"
	@echo "‚îÇ     ‚îÇ   ‚îú‚îÄ‚îÄ Security hardening (CIS benchmarks, UFW, Fail2Ban)            ‚îÇ"
	@echo "‚îÇ     ‚îÇ   ‚îú‚îÄ‚îÄ Web server setup (Nginx + SSL + security headers)             ‚îÇ"
	@echo "‚îÇ     ‚îÇ   ‚îî‚îÄ‚îÄ Monitoring setup (CloudWatch agent + log rotation)            ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ ‚úÖ Integration validation (HTTP tests + security headers)         ‚îÇ"
	@echo "‚îÇ     ‚îú‚îÄ‚îÄ üåê Live demonstration (show running infrastructure)               ‚îÇ"
	@echo "‚îÇ     ‚îî‚îÄ‚îÄ üßπ Resource cleanup (destroy all AWS resources)                   ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  4Ô∏è‚É£  make clean    ‚Üí Clean up local temporary files                       ‚îÇ"
	@echo "‚îÇ     ‚îî‚îÄ‚îÄ Removes: terraform cache, test cache, ansible backup files       ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  5Ô∏è‚É£  make destroy  ‚Üí Emergency cleanup (if steel-thread didn't finish)   ‚îÇ"
	@echo "‚îÇ     ‚îî‚îÄ‚îÄ Force destroy all AWS resources                                    ‚îÇ"
	@echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
	@echo ""
	@echo "üîó Target Dependencies:"
	@echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
	@echo "‚îÇ                            DEPENDENCY FLOW                                 ‚îÇ"
	@echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  setup (prerequisite for all)                                              ‚îÇ"
	@echo "‚îÇ    ‚îÇ                                                                       ‚îÇ"
	@echo "‚îÇ    ‚îú‚îÄ‚îÄ‚Üí check (validates setup worked)                                     ‚îÇ"
	@echo "‚îÇ    ‚îÇ                                                                       ‚îÇ"
	@echo "‚îÇ    ‚îî‚îÄ‚îÄ‚Üí steel-thread (requires setup + includes check validation)         ‚îÇ"
	@echo "‚îÇ              ‚îÇ                                                             ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] terraform plan                               ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] terraform apply                              ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] ansible security role                       ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] ansible nginx role                          ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] ansible monitoring role                     ‚îÇ"
	@echo "‚îÇ              ‚îú‚îÄ‚îÄ‚Üí [internal] integration tests                           ‚îÇ"
	@echo "‚îÇ              ‚îî‚îÄ‚îÄ‚Üí [internal] terraform destroy (cleanup)                 ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  clean (independent - removes local files)                                 ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îÇ  destroy (emergency only - removes AWS resources)                          ‚îÇ"
	@echo "‚îÇ                                                                             ‚îÇ"
	@echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
	@echo ""
	@echo "‚ö° Quick Start:"
	@echo "  make setup && make check && make steel-thread"
	@echo ""
	@echo "üîß Development Cycle:"
	@echo "  make setup    (first time only)"
	@echo "  make check    (fast validation)"
	@echo "  make clean    (cleanup temp files)"
	@echo ""
	@echo "üìã Prerequisites in README.md - run if setup fails"

setup: ## Initialize environment and install dependencies
	@echo "üîß Setting up environment..."
	@echo "üìã Detecting and validating CLI tools..."
	@./scripts/find-tools.sh >/dev/null 2>&1 || { echo "‚ùå Missing required tools. Run: ./scripts/find-tools.sh for details or see README.md"; exit 1; }
	@echo "‚úÖ All CLI tools detected"
	@AWS_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "AWS_PATH=" | cut -d'"' -f2) && \
		$$AWS_CMD sts get-caller-identity >/dev/null 2>&1 || { echo "‚ùå AWS credentials not configured. Run: aws configure or see README.md"; exit 1; }
	@python3 -c "import boto3, pytest, requests" 2>/dev/null || pip3 install boto3 pytest requests
	@test -f ~/.ssh/id_rsa.pub || { echo "‚ùå SSH key not found. Generate with: ssh-keygen -t rsa -b 4096 or see README.md"; exit 1; }
	@echo "üîë Setting up real terraform configuration..."
	@cd terraform && \
		(test -f terraform.tfvars && echo "üìù terraform.tfvars exists, skipping creation") || \
		(echo "üìù Creating terraform.tfvars with real values..." && \
		echo "# Real configuration - created by make setup" > terraform.tfvars && \
		echo "aws_region = \"us-east-1\"" >> terraform.tfvars && \
		echo "environment = \"dev\"" >> terraform.tfvars && \
		echo "instance_type = \"t3.micro\"" >> terraform.tfvars && \
		echo "" >> terraform.tfvars && \
		echo "# Your actual SSH public key" >> terraform.tfvars && \
		printf 'ssh_public_key = "%s"\n' "$$(cat ~/.ssh/id_rsa.pub)" >> terraform.tfvars && \
		echo "" >> terraform.tfvars && \
		echo "# IMPORTANT: Replace with your real email for AWS budget alerts" >> terraform.tfvars && \
		echo "notification_email = \"REPLACE-WITH-YOUR-EMAIL@domain.com\"" >> terraform.tfvars && \
		echo "" >> terraform.tfvars && \
		echo "# Optional: Restrict SSH access to your IP (default allows all)" >> terraform.tfvars && \
		echo "# allowed_cidr_blocks = [\"YOUR.IP.ADDRESS.HERE/32\"]" >> terraform.tfvars)
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD init
	@echo ""
	@echo "‚ö†Ô∏è  IMPORTANT: Edit terraform/terraform.tfvars and replace REPLACE-WITH-YOUR-EMAIL@domain.com with your real email"
	@echo "‚úÖ Environment setup complete"


check: ## Check all configurations without AWS deployment
	@echo "üîç Quick validation without AWS deployment"
	@echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
	@./scripts/find-tools.sh >/dev/null 2>&1 && echo "‚úÖ CLI tools detected" || { echo "‚ùå Missing tools - see README.md"; exit 1; }
	@cd terraform && terraform validate >/dev/null 2>&1 && echo "‚úÖ Terraform valid" || { echo "‚ùå Terraform failed - see README.md"; exit 1; }
	@ANSIBLE_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "ANSIBLE_PLAYBOOK_PATH=" | cut -d'"' -f2) && $$ANSIBLE_CMD --syntax-check ansible/site.yml >/dev/null 2>&1 && echo "‚úÖ Ansible valid" || { echo "‚ùå Ansible failed - see README.md"; exit 1; }
	@python3 -m pytest tests/test_infrastructure.py -q >/dev/null 2>&1 && echo "‚úÖ Infrastructure tests pass" || { echo "‚ùå Tests failed - see README.md"; exit 1; }
	@python3 -m pytest tests/test_configuration.py -q >/dev/null 2>&1 && echo "‚úÖ Configuration tests pass" || { echo "‚ùå Tests failed - see README.md"; exit 1; }
	@echo ""
	@echo "üéØ All checks passed - ready for steel-thread demo"

steel-thread: ## Complete end-to-end demo: deploy ‚Üí configure ‚Üí test ‚Üí show ‚Üí destroy
	@echo "üéØ STEEL-THREAD DEMONSTRATION"
	@echo "============================================="
	@echo "Complete DevOps automation: GitHub Actions ‚Üí Terraform ‚Üí Ansible ‚Üí Testing ‚Üí Cleanup"
	@echo ""
	@read -p "Deploy live AWS infrastructure for demo? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	@echo ""
	@echo "üîç ENTRY: Environment Validation"
	@echo "   ‚Üí Detecting CLI tools and validating configuration"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		AWS_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "AWS_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD validate >/dev/null 2>&1 && echo "   ‚Üí Terraform configuration: ‚úÖ VALID" || echo "   ‚Üí Terraform configuration: ‚ùå FAILED"
	@AWS_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "AWS_PATH=" | cut -d'"' -f2) && \
		$$AWS_CMD sts get-caller-identity >/dev/null 2>&1 && echo "   ‚Üí AWS credentials: ‚úÖ AUTHENTICATED" || echo "   ‚Üí AWS credentials: ‚ùå FAILED"
	@echo "üîç EXIT: Environment ready for deployment"
	@echo ""
	@echo "üöÄ ENTRY: Infrastructure Provisioning (Terraform ‚Üí AWS)"
	@echo "   ‚Üí Planning deployment: VPC, EC2, S3, Security Groups, CloudWatch"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD plan -var-file=terraform.tfvars -compact-warnings
	@echo "   ‚Üí Provisioning infrastructure: Creating 14 AWS resources"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD apply -var-file=terraform.tfvars -auto-approve
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && WEB_IP=$$($$TERRAFORM_CMD output -raw web_instance_public_ip) && echo "   ‚Üí Infrastructure provisioned: ‚úÖ COMPLETE (http://$$WEB_IP)"
	@echo "üöÄ EXIT: Infrastructure ready for configuration"
	@echo ""
	@echo "   ‚Üí Instance boot delay: Waiting 60 seconds for EC2 readiness"
	@sleep 60
	@echo ""
	@echo "‚öôÔ∏è ENTRY: Configuration Management (Ansible)"
	@echo "   ‚Üí Updating Ansible inventory with actual EC2 IP address"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && WEB_IP=$$($$TERRAFORM_CMD output -raw web_instance_public_ip) && \
		cd ../ansible && \
		sed -i.bak "s/ansible_host: 127.0.0.1/ansible_host: $$WEB_IP/" inventory/hosts.yml && \
		sed -i.bak "s/placeholder:/web1:/" inventory/hosts.yml
	@echo "   ‚Üí Security hardening: Applying CIS benchmarks, UFW firewall, Fail2Ban protection"
	@ANSIBLE_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "ANSIBLE_PLAYBOOK_PATH=" | cut -d'"' -f2) && \
		cd ansible && $$ANSIBLE_CMD -i inventory/hosts.yml site.yml --limit web --tags security
	@echo "   ‚Üí Security hardening: ‚úÖ APPLIED"
	@echo "   ‚Üí Web server setup: Installing Nginx with SSL and security headers"
	@ANSIBLE_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "ANSIBLE_PLAYBOOK_PATH=" | cut -d'"' -f2) && \
		cd ansible && $$ANSIBLE_CMD -i inventory/hosts.yml site.yml --limit web --tags nginx
	@echo "   ‚Üí Web server setup: ‚úÖ CONFIGURED"
	@echo "   ‚Üí Monitoring setup: Configuring CloudWatch agent and log rotation"
	@ANSIBLE_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "ANSIBLE_PLAYBOOK_PATH=" | cut -d'"' -f2) && \
		cd ansible && $$ANSIBLE_CMD -i inventory/hosts.yml site.yml --limit web --tags monitoring
	@echo "   ‚Üí Monitoring setup: ‚úÖ ACTIVE"
	@echo "‚öôÔ∏è EXIT: Configuration management complete"
	@echo ""
	@echo "‚úÖ ENTRY: Integration Validation"
	@echo "   ‚Üí HTTP endpoint testing: Validating web server response and availability"
	@python3 -m pytest tests/test_integration.py::TestIntegration::test_web_server_accessibility -v
	@echo "   ‚Üí Security header validation: Verifying HTTPS, HSTS, CSP headers"
	@python3 -m pytest tests/test_integration.py::TestIntegration::test_security_headers -v
	@echo "   ‚Üí Health check validation: Testing monitoring and status endpoints"
	@python3 -m pytest tests/test_integration.py::TestIntegration::test_health_check_endpoint -v
	@echo "‚úÖ EXIT: System validation complete"
	@echo ""
	@echo "üåê ENTRY: Live Demonstration"
	@cd terraform && WEB_IP=$$(terraform output -raw web_instance_public_ip) && echo "   ‚Üí Professional dashboard: http://$$WEB_IP" && echo "   ‚Üí Monitoring interface: http://$$WEB_IP/monitoring.html" && echo "   ‚Üí Health check endpoint:" && curl -s "http://$$WEB_IP/health"
	@echo "üåê EXIT: Demo complete - infrastructure running"
	@echo ""
	@echo "üéâ STEEL-THREAD COMPLETE!"
	@echo "Real infrastructure accessible at URLs above ‚Üë"
	@echo ""
	@echo "Press ENTER to destroy all resources and cleanup..."
	@read
	@echo ""
	@echo "üßπ ENTRY: Resource Cleanup"
	@echo "   ‚Üí Infrastructure destruction: Destroying all AWS resources (VPC, EC2, S3, etc.)"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD destroy -var-file=terraform.tfvars -auto-approve
	@echo "   ‚Üí Cleanup verification: Confirming all resources destroyed"
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD state list | wc -l | awk '{if($$1==0) print "   ‚Üí Resource cleanup: ‚úÖ ALL DESTROYED"; else print "   ‚Üí Resource cleanup: ‚ö†Ô∏è  SOME REMAIN"}'
	@echo "üßπ EXIT: Cleanup complete"
	@echo ""
	@echo "üèÜ Steel-thread demo complete - ready for next run!"

clean: ## Clean up temporary files and state
	@echo "üßπ Cleaning up temporary files..."
	@rm -f terraform/tfplan
	@rm -f terraform/.terraform.lock.hcl
	@rm -rf terraform/.terraform/
	@rm -rf tests/__pycache__/
	@rm -rf ansible/retry/
	@rm -f ansible/inventory/hosts.yml.bak
	@echo "‚úÖ Cleanup complete"

destroy: ## Destroy all infrastructure (WARNING: irreversible)
	@echo "‚ö†Ô∏è  WARNING: This will destroy all infrastructure!"
	@echo "This includes EC2, VPC, S3, CloudWatch logs, and all associated resources"
	@echo ""
	@read -p "Are you sure you want to destroy everything? Type 'yes' to confirm: " confirm && [ "$$confirm" = "yes" ] || { echo "‚ùå Destruction cancelled"; exit 1; }
	@TERRAFORM_CMD=$$(./scripts/find-tools.sh 2>/dev/null | grep "TERRAFORM_PATH=" | cut -d'"' -f2) && \
		cd terraform && $$TERRAFORM_CMD destroy -auto-approve || { echo "‚ùå FAILED - see README.md for setup"; exit 1; }
	@echo "‚úÖ Infrastructure destroyed"